<!DOCTYPE html><html lang="en" style="font-size:16px"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Class: Consensus</title><!--[if lt IE 9]>
      <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]--><script src="scripts/third-party/hljs.js" defer="defer"></script><script src="scripts/third-party/hljs-line-num.js" defer="defer"></script><script src="scripts/third-party/popper.js" defer="defer"></script><script src="scripts/third-party/tippy.js" defer="defer"></script><script src="scripts/third-party/tocbot.min.js"></script><script>var baseURL="/",locationPathname="";baseURL=(locationPathname=document.location.pathname).substr(0,locationPathname.lastIndexOf("/")+1)</script><link rel="stylesheet" href="styles/clean-jsdoc-theme.min.css"><svg aria-hidden="true" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="display:none"><defs><symbol id="copy-icon" viewbox="0 0 488.3 488.3"><g><path d="M314.25,85.4h-227c-21.3,0-38.6,17.3-38.6,38.6v325.7c0,21.3,17.3,38.6,38.6,38.6h227c21.3,0,38.6-17.3,38.6-38.6V124    C352.75,102.7,335.45,85.4,314.25,85.4z M325.75,449.6c0,6.4-5.2,11.6-11.6,11.6h-227c-6.4,0-11.6-5.2-11.6-11.6V124    c0-6.4,5.2-11.6,11.6-11.6h227c6.4,0,11.6,5.2,11.6,11.6V449.6z"/><path d="M401.05,0h-227c-21.3,0-38.6,17.3-38.6,38.6c0,7.5,6,13.5,13.5,13.5s13.5-6,13.5-13.5c0-6.4,5.2-11.6,11.6-11.6h227    c6.4,0,11.6,5.2,11.6,11.6v325.7c0,6.4-5.2,11.6-11.6,11.6c-7.5,0-13.5,6-13.5,13.5s6,13.5,13.5,13.5c21.3,0,38.6-17.3,38.6-38.6    V38.6C439.65,17.3,422.35,0,401.05,0z"/></g></symbol><symbol id="search-icon" viewBox="0 0 512 512"><g><g><path d="M225.474,0C101.151,0,0,101.151,0,225.474c0,124.33,101.151,225.474,225.474,225.474    c124.33,0,225.474-101.144,225.474-225.474C450.948,101.151,349.804,0,225.474,0z M225.474,409.323    c-101.373,0-183.848-82.475-183.848-183.848S124.101,41.626,225.474,41.626s183.848,82.475,183.848,183.848    S326.847,409.323,225.474,409.323z"/></g></g><g><g><path d="M505.902,476.472L386.574,357.144c-8.131-8.131-21.299-8.131-29.43,0c-8.131,8.124-8.131,21.306,0,29.43l119.328,119.328    c4.065,4.065,9.387,6.098,14.715,6.098c5.321,0,10.649-2.033,14.715-6.098C514.033,497.778,514.033,484.596,505.902,476.472z"/></g></g></symbol><symbol id="font-size-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11.246 15H4.754l-2 5H.6L7 4h2l6.4 16h-2.154l-2-5zm-.8-2L8 6.885 5.554 13h4.892zM21 12.535V12h2v8h-2v-.535a4 4 0 1 1 0-6.93zM19 18a2 2 0 1 0 0-4 2 2 0 0 0 0 4z"/></symbol><symbol id="add-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M11 11V5h2v6h6v2h-6v6h-2v-6H5v-2z"/></symbol><symbol id="minus-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M5 11h14v2H5z"/></symbol><symbol id="dark-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M10 7a7 7 0 0 0 12 4.9v.1c0 5.523-4.477 10-10 10S2 17.523 2 12 6.477 2 12 2h.1A6.979 6.979 0 0 0 10 7zm-6 5a8 8 0 0 0 15.062 3.762A9 9 0 0 1 8.238 4.938 7.999 7.999 0 0 0 4 12z"/></symbol><symbol id="light-theme-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 18a6 6 0 1 1 0-12 6 6 0 0 1 0 12zm0-2a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM11 1h2v3h-2V1zm0 19h2v3h-2v-3zM3.515 4.929l1.414-1.414L7.05 5.636 5.636 7.05 3.515 4.93zM16.95 18.364l1.414-1.414 2.121 2.121-1.414 1.414-2.121-2.121zm2.121-14.85l1.414 1.415-2.121 2.121-1.414-1.414 2.121-2.121zM5.636 16.95l1.414 1.414-2.121 2.121-1.414-1.414 2.121-2.121zM23 11v2h-3v-2h3zM4 11v2H1v-2h3z"/></symbol><symbol id="reset-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M18.537 19.567A9.961 9.961 0 0 1 12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10c0 2.136-.67 4.116-1.81 5.74L17 12h3a8 8 0 1 0-2.46 5.772l.997 1.795z"/></symbol><symbol id="down-icon" viewBox="0 0 16 16"><path fill-rule="evenodd" clip-rule="evenodd" d="M12.7803 6.21967C13.0732 6.51256 13.0732 6.98744 12.7803 7.28033L8.53033 11.5303C8.23744 11.8232 7.76256 11.8232 7.46967 11.5303L3.21967 7.28033C2.92678 6.98744 2.92678 6.51256 3.21967 6.21967C3.51256 5.92678 3.98744 5.92678 4.28033 6.21967L8 9.93934L11.7197 6.21967C12.0126 5.92678 12.4874 5.92678 12.7803 6.21967Z"></path></symbol><symbol id="codepen-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M16.5 13.202L13 15.535v3.596L19.197 15 16.5 13.202zM14.697 12L12 10.202 9.303 12 12 13.798 14.697 12zM20 10.869L18.303 12 20 13.131V10.87zM19.197 9L13 4.869v3.596l3.5 2.333L19.197 9zM7.5 10.798L11 8.465V4.869L4.803 9 7.5 10.798zM4.803 15L11 19.131v-3.596l-3.5-2.333L4.803 15zM4 13.131L5.697 12 4 10.869v2.262zM2 9a1 1 0 0 1 .445-.832l9-6a1 1 0 0 1 1.11 0l9 6A1 1 0 0 1 22 9v6a1 1 0 0 1-.445.832l-9 6a1 1 0 0 1-1.11 0l-9-6A1 1 0 0 1 2 15V9z"/></symbol><symbol id="close-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M12 10.586l4.95-4.95 1.414 1.414-4.95 4.95 4.95 4.95-1.414 1.414-4.95-4.95-4.95 4.95-1.414-1.414 4.95-4.95-4.95-4.95L7.05 5.636z"/></symbol><symbol id="menu-icon" viewBox="0 0 24 24"><path fill="none" d="M0 0h24v24H0z"/><path d="M3 4h18v2H3V4zm0 7h18v2H3v-2zm0 7h18v2H3v-2z"/></symbol></defs></svg></head><body data-theme="dark"><div class="sidebar-container"><div class="sidebar" id="sidebar"><div class="sidebar-items-container"><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-modules"><div>Modules</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-brig.html">brig</a></div><div class="sidebar-section-children"><a href="module-brig_consensus.html">brig/consensus</a></div><div class="sidebar-section-children"><a href="module-brig_events.html">brig/events</a></div><div class="sidebar-section-children"><a href="module-brig_log.html">brig/log</a></div><div class="sidebar-section-children"><a href="module-brig_messages.html">brig/messages</a></div><div class="sidebar-section-children"><a href="module-brig_roles.html">brig/roles</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-classes"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-brig_consensus-Consensus.html">Consensus</a></div><div class="sidebar-section-children"><a href="module-brig_consensus-Peer.html">Peer</a></div><div class="sidebar-section-children"><a href="module-brig_log-Log.html">Log</a></div><div class="sidebar-section-children"><a href="module-brig_log-LogEntry.html">LogEntry</a></div><div class="sidebar-section-children"><a href="module-brig_log-LogState.html">LogState</a></div><div class="sidebar-section-children"><a href="module-brig_messages-LogRequestMessage.html">LogRequestMessage</a></div><div class="sidebar-section-children"><a href="module-brig_messages-LogResponseMessage.html">LogResponseMessage</a></div><div class="sidebar-section-children"><a href="module-brig_messages-VoteRequestMessage.html">VoteRequestMessage</a></div><div class="sidebar-section-children"><a href="module-brig_messages-VoteResponseMessage.html">VoteResponseMessage</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-events"><div>Events</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-brig_events.html#~event:Broadcast">Broadcast</a></div><div class="sidebar-section-children"><a href="module-brig_events.html#~event:Debug">Debug</a></div><div class="sidebar-section-children"><a href="module-brig_events.html#~event:ElectionTimeout">ElectionTimeout</a></div><div class="sidebar-section-children"><a href="module-brig_events.html#~event:LogCommit">LogCommit</a></div><div class="sidebar-section-children"><a href="module-brig_events.html#~event:LogRequest">LogRequest</a></div><div class="sidebar-section-children"><a href="module-brig_events.html#~event:LogResponse">LogResponse</a></div><div class="sidebar-section-children"><a href="module-brig_events.html#~event:ReplicationTimeout">ReplicationTimeout</a></div><div class="sidebar-section-children"><a href="module-brig_events.html#~event:RoleChanged">RoleChanged</a></div><div class="sidebar-section-children"><a href="module-brig_events.html#~event:VoteRequest">VoteRequest</a></div><div class="sidebar-section-children"><a href="module-brig_events.html#~event:VoteResponse">VoteResponse</a></div></div></div></div></div><div class="navbar-container" id="VuAckcnZhf"><nav class="navbar"><div class="navbar-left-items"></div><div class="navbar-right-items"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div><nav></nav></nav></div><div class="toc-container"><div class="toc-content"><span class="bold">On this page</span><div id="eed4d2a0bfd64539bb9df78095dec881"></div></div></div><div class="body-wrapper"><div class="main-content"><div class="main-wrapper"><section><header><h1 id="Consensus-title" class="has-anchor"><span class="ancestors"><a href="module-brig_consensus.html">brig/consensus</a>~</span> Consensus</h1></header><article><div class="container-overview"><h3 class="name has-anchor" id="Consensus"><span class="type-signature"></span>new Consensus<span class="signature">(id, peers<span class="signature-attributes">opt</span>, logState<span class="signature-attributes">opt</span>)</span></h3><div class="description"><p>Primary brig interface. A synchronized, crash-fault-tolerant state machine consensus layer. Implements a Raft-like protocol.</p></div><div class="method-member-container flex flex-col w-100 overflow-auto mt-20"><strong>Parameters:</strong><table class="params"><thead><tr><th>Name</th><th>Type</th><th>Attributes</th><th>Default</th><th class="last">Description</th></tr></thead><tbody><tr><td class="name"><code>id</code></td><td class="type"><span class="param-type">buffer</span></td><td class="attributes"></td><td class="default"></td><td class="description last"><p>Unique identifier for this node.</p></td></tr><tr><td class="name"><code>peers</code></td><td class="type"><span class="param-type">Array.&lt;<a href="module-brig_consensus-Peer.html">module:brig/consensus~Peer</a>></span></td><td class="attributes">&lt;optional><br></td><td class="default">[]</td><td class="description last"><p>Peer nodes.</p></td></tr><tr><td class="name"><code>logState</code></td><td class="type"><span class="param-type"><a href="module-brig_log-LogState.html">module:brig/log~LogState</a></span></td><td class="attributes">&lt;optional><br></td><td class="default"></td><td class="description last"><p>Initialize with the given state machine.</p></td></tr></tbody></table></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="lib_consensus.js.html">lib/consensus.js</a>, <a href="lib_consensus.js.html#line75">line 75</a></li></ul></dd></div></dl></div><h2 id="members" class="subsection-title has-anchor">Members</h2><h3 class="name has-anchor" id="id"><span class="type-signature"></span>id<span class="type-signature"></span></h3><b class="subsection-title">Properties</b><div class="allow-overflow"><table class="props"><thead><tr><th>Name</th><th>Type</th><th class="last">Description</th></tr></thead><tbody><tr><td class="name"><code>id</code></td><td class="type"><span class="param-type">string</span> |<wbr> <span class="param-type">number</span></td><td class="description last"><p>Unique identifier for this context.</p></td></tr></tbody></table></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="lib_consensus.js.html">lib/consensus.js</a>, <a href="lib_consensus.js.html#line81">line 81</a></li></ul></dd></div></dl><h3 class="name has-anchor" id="peers"><span class="type-signature"></span>peers<span class="type-signature"></span></h3><b class="subsection-title">Properties</b><div class="allow-overflow"><table class="props"><thead><tr><th>Name</th><th>Type</th><th class="last">Description</th></tr></thead><tbody><tr><td class="name"><code>peers</code></td><td class="type"><span class="param-type">Array.&lt;<a href="module-brig_consensus-Peer.html">module:brig/consensus~Peer</a>></span></td><td class="description last"><p>Synchonized nodes.</p></td></tr></tbody></table></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="lib_consensus.js.html">lib/consensus.js</a>, <a href="lib_consensus.js.html#line91">line 91</a></li></ul></dd></div></dl><h3 class="name has-anchor" id="state"><span class="type-signature"></span>state<span class="type-signature"></span></h3><b class="subsection-title">Properties</b><div class="allow-overflow"><table class="props"><thead><tr><th>Name</th><th>Type</th><th class="last">Description</th></tr></thead><tbody><tr><td class="name"><code>state</code></td><td class="type"><span class="param-type"><a href="module-brig_log-LogState.html">module:brig/log~LogState</a></span></td><td class="description last"><p>Underlying state machine.</p></td></tr></tbody></table></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="lib_consensus.js.html">lib/consensus.js</a>, <a href="lib_consensus.js.html#line85">line 85</a></li></ul></dd></div></dl><h2 id="methods" class="subsection-title has-anchor">Methods</h2><h3 class="name has-anchor" id="acks"><span class="type-signature"></span>acks<span class="signature">(x)</span><span class="type-signature"> &rarr; {number}</span></h3><div class="description"><p>The number of nodes whose <code>ackedLength</code> is greater than or equal to x.</p></div><div class="method-member-container flex flex-col w-100 overflow-auto mt-20"><strong>Parameters:</strong><table class="params"><thead><tr><th>Name</th><th>Type</th><th class="last">Description</th></tr></thead><tbody><tr><td class="name"><code>x</code></td><td class="type"><span class="param-type">number</span></td><td class="description last"><p>Minimum number of acks.</p></td></tr></tbody></table></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="lib_consensus.js.html">lib/consensus.js</a>, <a href="lib_consensus.js.html#line683">line 683</a></li></ul></dd></div></dl><div class="method-member-container mt-20"><strong>Returns:</strong><dl class="param-type"><dt>Type:&nbsp;</dt><dd><span class="param-type">number</span></dd></dl></div><h3 class="name has-anchor" id="addPeer"><span class="type-signature"></span>addPeer<span class="signature">(peer)</span><span class="type-signature"> &rarr; {<a href="module-brig_consensus-Peer.html">module:brig/consensus~Peer</a>}</span></h3><div class="description"><p>Adds a peer to the cluster.</p></div><div class="method-member-container flex flex-col w-100 overflow-auto mt-20"><strong>Parameters:</strong><table class="params"><thead><tr><th>Name</th><th>Type</th><th class="last">Description</th></tr></thead><tbody><tr><td class="name"><code>peer</code></td><td class="type"><span class="param-type"><a href="module-brig_consensus-Peer.html">module:brig/consensus~Peer</a></span></td><td class="description last"><p>Peer to add to cluster.</p></td></tr></tbody></table></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="lib_consensus.js.html">lib/consensus.js</a>, <a href="lib_consensus.js.html#line193">line 193</a></li></ul></dd></div></dl><div class="method-member-container mt-20"><strong>Returns:</strong><dl class="param-type"><dt>Type:&nbsp;</dt><dd><span class="param-type"><a href="module-brig_consensus-Peer.html">module:brig/consensus~Peer</a></span></dd></dl></div><h3 class="name has-anchor" id="appendEntries"><span class="type-signature"></span>appendEntries<span class="signature">(prefixLength, leaderCommit, suffix)</span></h3><div class="description"><p>Appends the suffix log entries to the log of the follower. Here we check whether the follower has the same suffix log entries as the leader. If not, the follower will remove all the log entries after prefix from its log, and append the suffix log entries from leader to its log.</p></div><div class="method-member-container flex flex-col w-100 overflow-auto mt-20"><strong>Parameters:</strong><table class="params"><thead><tr><th>Name</th><th>Type</th><th class="last">Description</th></tr></thead><tbody><tr><td class="name"><code>prefixLength</code></td><td class="type"><span class="param-type">number</span></td><td class="description last"><p>Number of entries before current.</p></td></tr><tr><td class="name"><code>leaderCommit</code></td><td class="type"><span class="param-type">number</span></td><td class="description last"><p>Number of commits on the leader.</p></td></tr><tr><td class="name"><code>suffix</code></td><td class="type"><span class="param-type">Array.&lt;<a href="module-brig_log-LogEntry.html">module:brig/log~LogEntry</a>></span></td><td class="description last"><p>Entries to append.</p></td></tr></tbody></table></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="lib_consensus.js.html">lib/consensus.js</a>, <a href="lib_consensus.js.html#line601">line 601</a></li></ul></dd></div></dl><h3 class="name has-anchor" id="broadcast"><span class="type-signature"></span>broadcast<span class="signature">(payload)</span><span class="type-signature"> &rarr; {<a href="module-brig_consensus-Consensus.html">module:brig/consensus~Consensus</a>}</span></h3><div class="description"><p>Helper function for broadcasting a log entry.</p></div><div class="method-member-container flex flex-col w-100 overflow-auto mt-20"><strong>Parameters:</strong><table class="params"><thead><tr><th>Name</th><th>Type</th><th class="last">Description</th></tr></thead><tbody><tr><td class="name"><code>payload</code></td><td class="type"><span class="param-type">object</span></td><td class="description last"><p>Key-value pairs to include in log entry.</p></td></tr></tbody></table></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="lib_consensus.js.html">lib/consensus.js</a>, <a href="lib_consensus.js.html#line457">line 457</a></li></ul></dd></div></dl><div class="method-member-container mt-20"><strong>Returns:</strong><dl class="param-type"><dt>Type:&nbsp;</dt><dd><span class="param-type"><a href="module-brig_consensus-Consensus.html">module:brig/consensus~Consensus</a></span></dd></dl></div><h3 class="name has-anchor" id="commitLogEntries"><span class="type-signature"></span>commitLogEntries<span class="signature">()</span></h3><div class="description"><p>If the leader receives a majority of acknowledgements for a log entry, it will commit the log entry.</p></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="lib_consensus.js.html">lib/consensus.js</a>, <a href="lib_consensus.js.html#line700">line 700</a></li></ul></dd></div></dl><h3 class="name has-anchor" id="getPeer"><span class="type-signature"></span>getPeer<span class="signature">(peerId)</span><span class="type-signature"> &rarr; {<a href="module-brig_consensus-Peer.html">module:brig/consensus~Peer</a>}</span></h3><div class="description"><p>Get peer from list by ID.</p></div><div class="method-member-container flex flex-col w-100 overflow-auto mt-20"><strong>Parameters:</strong><table class="params"><thead><tr><th>Name</th><th>Type</th><th class="last">Description</th></tr></thead><tbody><tr><td class="name"><code>peerId</code></td><td class="type"><span class="param-type">string</span></td><td class="description last"><p>Identifier for the peer node.</p></td></tr></tbody></table></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="lib_consensus.js.html">lib/consensus.js</a>, <a href="lib_consensus.js.html#line172">line 172</a></li></ul></dd></div></dl><div class="method-member-container mt-20"><strong>Returns:</strong><dl class="param-type"><dt>Type:&nbsp;</dt><dd><span class="param-type"><a href="module-brig_consensus-Peer.html">module:brig/consensus~Peer</a></span></dd></dl></div><h3 class="name has-anchor" id="handleBroadcast"><span class="type-signature"></span>handleBroadcast<span class="signature">(payload)</span></h3><div class="description"><p>When the application layer triggers a broadcast, the leader will append the broadcast message to its log, and send the log entry to all followers. If the current node is not a leader, it will forward the broadcast message to the leader.</p></div><div class="method-member-container flex flex-col w-100 overflow-auto mt-20"><strong>Parameters:</strong><table class="params"><thead><tr><th>Name</th><th>Type</th><th class="last">Description</th></tr></thead><tbody><tr><td class="name"><code>payload</code></td><td class="type"><span class="param-type">object</span></td><td class="description last"><p>Payload to be included in log entry broadcasted.</p></td></tr></tbody></table></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="lib_consensus.js.html">lib/consensus.js</a>, <a href="lib_consensus.js.html#line469">line 469</a></li></ul></dd></div></dl><h3 class="name has-anchor" id="handleLogRequest"><span class="type-signature"></span>handleLogRequest<span class="signature">(lReq)</span></h3><div class="description"><p>When a follower receives a synchronization message from the leader, it will perform the following steps:</p><ol><li><p>The follower will check whether the log is consistent with the log entries that the leader believes the follower has. If not, the follower will reject the synchronization request.</p></li><li><p>If the log is consistent, the follower will append the suffix log entries to its own log.</p></li><li><p>The follower will check whether the leader has committed any log entries. If so, the follower will commit the log entries that the leader has committed.</p></li></ol><p>To check whether the log is consistent, the follower will compare the term of the last log entry in the prefix with leader’s prefix_term. If they are not equal, the log is inconsistent. It is true due to a property of Raft: if two nodes have the same log term at the same index, then they have the same log entries at and before that index. Here we don’t give the proof of this property, but you can find it in the original paper.</p></div><div class="method-member-container flex flex-col w-100 overflow-auto mt-20"><strong>Parameters:</strong><table class="params"><thead><tr><th>Name</th><th>Type</th><th class="last">Description</th></tr></thead><tbody><tr><td class="name"><code>lReq</code></td><td class="type"><span class="param-type"><a href="module-brig_messages-LogRequestMessage.html">module:brig/messages~LogRequestMessage</a></span></td><td class="description last"><p>Append entries request message.</p></td></tr></tbody></table></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="lib_consensus.js.html">lib/consensus.js</a>, <a href="lib_consensus.js.html#line541">line 541</a></li></ul></dd></div></dl><h3 class="name has-anchor" id="handleLogResponse"><span class="type-signature"></span>handleLogResponse<span class="signature">(lRes)</span></h3><div class="description"><p>When the leader receives a log response from a follower, it will perform the following steps:</p><ol><li><p>If the synchronization is successful, the leader will update <code>ackedLength</code> and <code>sentLength</code> of the follower.</p></li><li><p>If the synchronization is failed, the leader will decrease <code>sentLength</code> of the follower by 1, and try again.</p></li></ol></div><div class="method-member-container flex flex-col w-100 overflow-auto mt-20"><strong>Parameters:</strong><table class="params"><thead><tr><th>Name</th><th>Type</th><th class="last">Description</th></tr></thead><tbody><tr><td class="name"><code>lRes</code></td><td class="type"><span class="param-type"><a href="module-brig_messages-LogResponseMessage.html">module:brig/messages~LogResponseMessage</a></span></td><td class="description last"><p>Append entries response message.</p></td></tr></tbody></table></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="lib_consensus.js.html">lib/consensus.js</a>, <a href="lib_consensus.js.html#line656">line 656</a></li></ul></dd></div></dl><h3 class="name has-anchor" id="handleReplicateLog"><span class="type-signature"></span>handleReplicateLog<span class="signature">()</span></h3><div class="description"><p>When the replication timer expires, the leader will synchronize its log with all followers. The synchronization message also serves as a heartbeat message.</p></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="lib_consensus.js.html">lib/consensus.js</a>, <a href="lib_consensus.js.html#line508">line 508</a></li></ul></dd></div></dl><h3 class="name has-anchor" id="handleVoteRequest"><span class="type-signature"></span>handleVoteRequest<span class="signature">(vReq)</span></h3><div class="description"><p>When node A receives a voting request from node B, it will perform the following steps:</p><ol><li><p>Check if the term of B is greater than or equal the current term of A. If not, A will reject the voting request, since voting for B might result in multiple leaders in B’s term.</p></li><li><p>Check if the log of B is more or equal up-to-date than the log of A. If not, A will reject the voting request, since voting for B might result in log entries being lost.</p></li><li><p>Check if A has already voted for another candidate in the current term. If so, A will reject the voting request, since voting for B might result in multiple leaders in the current term.</p></li></ol></div><div class="method-member-container flex flex-col w-100 overflow-auto mt-20"><strong>Parameters:</strong><table class="params"><thead><tr><th>Name</th><th>Type</th><th class="last">Description</th></tr></thead><tbody><tr><td class="name"><code>vReq</code></td><td class="type"><span class="param-type"><a href="module-brig_messages-VoteRequestMessage.html">module:brig/messages~VoteRequestMessage</a></span></td><td class="description last"><p>Vote request message.</p></td></tr></tbody></table></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="lib_consensus.js.html">lib/consensus.js</a>, <a href="lib_consensus.js.html#line279">line 279</a></li></ul></dd></div></dl><h3 class="name has-anchor" id="handleVoteResponse"><span class="type-signature"></span>handleVoteResponse<span class="signature">(vRes)</span></h3><div class="description"><p>Upon receiving voting responses, a node should check whether it has received a majority of votes. If so, it should transition to the role of leader. Otherwise, it should remain a candidate.</p></div><div class="method-member-container flex flex-col w-100 overflow-auto mt-20"><strong>Parameters:</strong><table class="params"><thead><tr><th>Name</th><th>Type</th><th class="last">Description</th></tr></thead><tbody><tr><td class="name"><code>vRes</code></td><td class="type"><span class="param-type"><a href="module-brig_messages-VoteResponseMessage.html">module:brig/messages~VoteResponseMessage</a></span></td><td class="description last"><p>Vote response message to handle.</p></td></tr></tbody></table></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="lib_consensus.js.html">lib/consensus.js</a>, <a href="lib_consensus.js.html#line347">line 347</a></li></ul></dd></div></dl><h3 class="name has-anchor" id="replicateLog"><span class="type-signature"></span>replicateLog<span class="signature">(leader, follower)</span></h3><div class="description"><p>Helper function that synchronizes the log of the leader with a follower. The simplest way to synchronize the log is to send the entire log to the follower. However, this is inefficient. As mentioned earlier, the leader assumes that the log of the follower is the same as its own log when it becomes a leader. Therefore, the leader only needs to send the log entries that the follower does not have.</p><pre class="prettyprint source"><code>sentLength[follower] := log.length 
// the node assumes that the log of the follower is the same as its own log
</code></pre><p>The leader maintains a variable <code>sentLength</code> for each follower. <code>sentLength[follower]</code> denotes the length of the log that the leader believes the follower has. When the leader synchronizes the logs with the follower, it will send the log entries after <code>sentLength[follower]</code>. If the synchronization is failed, the leader will decrease <code>sentLength[follower]</code> by 1, and try again.</p></div><div class="method-member-container flex flex-col w-100 overflow-auto mt-20"><strong>Parameters:</strong><table class="params"><thead><tr><th>Name</th><th>Type</th><th class="last">Description</th></tr></thead><tbody><tr><td class="name"><code>leader</code></td><td class="type"><span class="param-type"><a href="module-brig_consensus-Peer.html">module:brig/consensus~Peer</a></span></td><td class="description last"><p>Peer to replicate from.</p></td></tr><tr><td class="name"><code>follower</code></td><td class="type"><span class="param-type"><a href="module-brig_consensus-Peer.html">module:brig/consensus~Peer</a></span></td><td class="description last"><p>Peer to replicate to.</p></td></tr></tbody></table></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="lib_consensus.js.html">lib/consensus.js</a>, <a href="lib_consensus.js.html#line425">line 425</a></li></ul></dd></div></dl><h3 class="name has-anchor" id="requestVotes"><span class="type-signature"></span>requestVotes<span class="signature">()</span><span class="type-signature"> &rarr; {<a href="module-brig_consensus-Consensus.html">module:brig/consensus~Consensus</a>}</span></h3><div class="description"><p>Requests votes from each peer.</p></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="lib_consensus.js.html">lib/consensus.js</a>, <a href="lib_consensus.js.html#line242">line 242</a></li></ul></dd></div></dl><div class="method-member-container mt-20"><strong>Returns:</strong><dl class="param-type"><dt>Type:&nbsp;</dt><dd><span class="param-type"><a href="module-brig_consensus-Consensus.html">module:brig/consensus~Consensus</a></span></dd></dl></div><h3 class="name has-anchor" id="resetElectionTimer"><span class="type-signature"></span>resetElectionTimer<span class="signature">()</span></h3><div class="description"><p>Resets the election timeout.</p></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="lib_consensus.js.html">lib/consensus.js</a>, <a href="lib_consensus.js.html#line205">line 205</a></li></ul></dd></div></dl><h3 class="name has-anchor" id="startElection"><span class="type-signature"></span>startElection<span class="signature">()</span></h3><div class="description"><p>Each node has a election timer, which is reset when receving the heartbeat from its leader. When the Election Timer expires, the follower will transition to the role of “candidate”. Following this transition, it will proceed to send voting requests to all nodes.</p></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="lib_consensus.js.html">lib/consensus.js</a>, <a href="lib_consensus.js.html#line219">line 219</a></li></ul></dd></div></dl><h3 class="name has-anchor" id=".getElectionTimeoutMs"><span class="type-signature">(static) </span>getElectionTimeoutMs<span class="signature">()</span><span class="type-signature"> &rarr; {number}</span></h3><div class="description"><p>Election timeout in milliseconds plus a randomized additional time.</p></div><dl class="details"><div class="details-item-container"><dt class="tag-source bold">Source</dt><dd class="tag-source"><ul><li><a href="lib_consensus.js.html">lib/consensus.js</a>, <a href="lib_consensus.js.html#line61">line 61</a></li></ul></dd></div></dl><div class="method-member-container mt-20"><strong>Returns:</strong><dl class="param-type"><dt>Type:&nbsp;</dt><dd><span class="param-type">number</span></dd></dl></div></article></section></div></div></div><div class="search-container" id="PkfLWpAbet" style="display:none"><div class="wrapper" id="iCxFxjkHbP"><button class="icon-button search-close-button" id="VjLlGakifb" aria-label="close search"><svg><use xlink:href="#close-icon"></use></svg></button><div class="search-box-c"><svg><use xlink:href="#search-icon"></use></svg> <input type="text" id="vpcKVYIppa" class="search-input" placeholder="Search..." autofocus></div><div class="search-result-c" id="fWwVHRuDuN"><span class="search-result-c-text">Type anything to view search result</span></div></div></div><div class="mobile-menu-icon-container"><button class="icon-button" id="mobile-menu" data-isopen="false" aria-label="menu"><svg><use xlink:href="#menu-icon"></use></svg></button></div><div id="mobile-sidebar" class="mobile-sidebar-container"><div class="mobile-sidebar-wrapper"><div class="mobile-nav-links"></div><div class="mobile-sidebar-items-c"><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-modules"><div>Modules</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-brig.html">brig</a></div><div class="sidebar-section-children"><a href="module-brig_consensus.html">brig/consensus</a></div><div class="sidebar-section-children"><a href="module-brig_events.html">brig/events</a></div><div class="sidebar-section-children"><a href="module-brig_log.html">brig/log</a></div><div class="sidebar-section-children"><a href="module-brig_messages.html">brig/messages</a></div><div class="sidebar-section-children"><a href="module-brig_roles.html">brig/roles</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-classes"><div>Classes</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-brig_consensus-Consensus.html">Consensus</a></div><div class="sidebar-section-children"><a href="module-brig_consensus-Peer.html">Peer</a></div><div class="sidebar-section-children"><a href="module-brig_log-Log.html">Log</a></div><div class="sidebar-section-children"><a href="module-brig_log-LogEntry.html">LogEntry</a></div><div class="sidebar-section-children"><a href="module-brig_log-LogState.html">LogState</a></div><div class="sidebar-section-children"><a href="module-brig_messages-LogRequestMessage.html">LogRequestMessage</a></div><div class="sidebar-section-children"><a href="module-brig_messages-LogResponseMessage.html">LogResponseMessage</a></div><div class="sidebar-section-children"><a href="module-brig_messages-VoteRequestMessage.html">VoteRequestMessage</a></div><div class="sidebar-section-children"><a href="module-brig_messages-VoteResponseMessage.html">VoteResponseMessage</a></div></div><div class="sidebar-section-title with-arrow" data-isopen="false" id="sidebar-events"><div>Events</div><svg><use xlink:href="#down-icon"></use></svg></div><div class="sidebar-section-children-container"><div class="sidebar-section-children"><a href="module-brig_events.html#~event:Broadcast">Broadcast</a></div><div class="sidebar-section-children"><a href="module-brig_events.html#~event:Debug">Debug</a></div><div class="sidebar-section-children"><a href="module-brig_events.html#~event:ElectionTimeout">ElectionTimeout</a></div><div class="sidebar-section-children"><a href="module-brig_events.html#~event:LogCommit">LogCommit</a></div><div class="sidebar-section-children"><a href="module-brig_events.html#~event:LogRequest">LogRequest</a></div><div class="sidebar-section-children"><a href="module-brig_events.html#~event:LogResponse">LogResponse</a></div><div class="sidebar-section-children"><a href="module-brig_events.html#~event:ReplicationTimeout">ReplicationTimeout</a></div><div class="sidebar-section-children"><a href="module-brig_events.html#~event:RoleChanged">RoleChanged</a></div><div class="sidebar-section-children"><a href="module-brig_events.html#~event:VoteRequest">VoteRequest</a></div><div class="sidebar-section-children"><a href="module-brig_events.html#~event:VoteResponse">VoteResponse</a></div></div></div><div class="mobile-navbar-actions"><div class="navbar-right-item"><button class="icon-button search-button" aria-label="open-search"><svg><use xlink:href="#search-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button theme-toggle" aria-label="toggle-theme"><svg><use class="theme-svg-use" xlink:href="#light-theme-icon"></use></svg></button></div><div class="navbar-right-item"><button class="icon-button font-size" aria-label="change-font-size"><svg><use xlink:href="#font-size-icon"></use></svg></button></div></div></div></div><script type="text/javascript" src="scripts/core.min.js"></script><script src="scripts/search.min.js" defer="defer"></script><script src="scripts/third-party/fuse.js" defer="defer"></script><script type="text/javascript">var tocbotInstance=tocbot.init({tocSelector:"#eed4d2a0bfd64539bb9df78095dec881",contentSelector:".main-content",headingSelector:"h1, h2, h3",hasInnerContainers:!0,scrollContainer:".main-content",headingsOffset:130,onClick:bringLinkToView})</script></body></html>